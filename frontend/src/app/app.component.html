<div class="container">
  <h1>Gerenciador de Tarefas</h1>

  <div class="task-form">
    <h2>{{ editingTask ? 'Editar Tarefa' : 'Nova Tarefa' }}</h2>

    <!-- Formulário de Nova Tarefa/Edição -->
    <input [(ngModel)]="currentTitle" placeholder="Título" />
    <input [(ngModel)]="currentDescription" placeholder="Descrição" />

    <select [(ngModel)]="currentStatus">
      <!-- Opções de status da tarefa -->
      <option value="pendente">Pendente</option>
      <option value="em-andamento">Em Andamento</option>
      <option value="concluida">Concluída</option>
    </select>

    <div class="form-actions">
      <!-- Lógica para mostrar Adicionar ou Salvar/Cancelar -->
      @if (!editingTask) {
        <!-- Botão Adicionar Tarefa (aparece se não estiver editando) -->
        <button (click)="createTask()">Adicionar Tarefa</button>
      } @else {
        <!-- Botões Salvar e Cancelar (aparecem se estiver editando) -->
        <button (click)="updateTask()">Salvar Alterações</button>
        <button class="cancel-btn" (click)="cancelEdit()">Cancelar</button>
      }
    </div>
  </div>

  <h2>Tarefas Atuais</h2>

  <!-- NOVO SELETOR DE FILTRO -->
  <div class="filter-controls">
    <label for="filterStatus">Filtrar por Status:</label>
    <!-- Usa 'filterStatus()' para ler o valor, e 'filterStatus.set($event)' para escrever no signal -->
    <select id="filterStatus" [ngModel]="filterStatus()" (ngModelChange)="filterStatus.set($event)">
      <option value="todos">Mostrar Todos</option>
      <option value="pendente">Pendente</option>
      <option value="em-andamento">Em Andamento</option>
      <option value="concluida">Concluída</option>
    </select>
  </div>

  <div class="task-list">
    <!-- CORREÇÃO: Usando a propriedade COMPUTADA 'filteredTasks()' como o array iterável -->
    @for (task of filteredTasks(); track task.id) {
      <div class="task-card">
        <div class="task-info">
          <h3>{{ task.title }}</h3>
          <p>{{ task.description }}</p>
        </div>

        <!-- Status da Tarefa com classe CSS dinâmica -->
        <div class="task-status status-{{ task.status }}">
          {{ task.status | titlecase }}
        </div>

        <div class="task-actions">
          <!-- BOTÃO COMPLEMENTAR: Concluir (aparece apenas se não estiver concluída) -->
          @if (task.status !== 'concluida') {
            <button class="complete-btn" (click)="completeTask(task)">Concluir</button>
          }
          <!-- Botões de Ação para cada tarefa -->
          <button class="edit-btn" (click)="editTask(task)">Editar</button>
          <!-- Chama o modal em vez da exclusão direta -->
          <button class="delete-btn" (click)="openDeleteModal(task)">Excluir</button>
        </div>
      </div>
    } @empty {
      <!-- CORREÇÃO: O empty block também deve usar 'filteredTasks' indiretamente (ele já está no @for) -->
      <p class="no-tasks">Nenhuma tarefa encontrada. Que tal criar uma?</p>
    }
  </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
@if (isDeleteModalOpen()) {
  <div class="modal-backdrop">
    <div class="modal-content">
      <h3>Confirmação de Exclusão</h3>
      <p>Tem certeza que deseja excluir a tarefa: <strong>"{{ taskToDelete()?.title }}"</strong>?</p>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeDeleteModal()">Cancelar</button>
        <button class="delete-btn" (click)="confirmDeleteTask()">Sim, Excluir</button>
      </div>
    </div>
  </div>
}
